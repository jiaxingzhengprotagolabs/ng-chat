{"version":3,"file":"ng-chat.js.map","sources":["ng://ng-chat/ng-chat/core/chat-adapter.ts","ng://ng-chat/ng-chat/core/message-type.enum.ts","ng://ng-chat/ng-chat/core/message.ts","ng://ng-chat/ng-chat/core/user-status.enum.ts","ng://ng-chat/ng-chat/core/user.ts","ng://ng-chat/ng-chat/core/window.ts","ng://ng-chat/ng-chat/core/paged-history-chat-adapter.ts","ng://ng-chat/ng-chat/core/theme.enum.ts","ng://ng-chat/ng-chat/core/scroll-direction.enum.ts","ng://ng-chat/ng-chat/core/default-file-upload-adapter.ts","ng://ng-chat/ng-chat/ng-chat.component.ts","ng://ng-chat/ng-chat/pipes/emojify.pipe.ts","ng://ng-chat/ng-chat/pipes/linkfy.pipe.ts","ng://ng-chat/ng-chat/ng-chat.module.ts"],"sourcesContent":["import { Observable } from 'rxjs';\r\nimport { Message } from \"./message\";\r\nimport { User } from \"./user\";\r\n\r\nexport abstract class ChatAdapter\r\n{\r\n    // ### Abstract adapter methods ###\r\n\r\n    public abstract listFriends(): Observable<User[]>;\r\n    \r\n    public abstract getMessageHistory(userId: any): Observable<Message[]>;\r\n\r\n    public abstract sendMessage(message: Message): void;\r\n\r\n    // ### Adapter/Chat income/ingress events ###\r\n\r\n    public onFriendsListChanged(users: User[]): void\r\n    {\r\n        this.friendsListChangedHandler(users);\r\n    }\r\n\r\n    public onMessageReceived(user: User, message: Message): void\r\n    {\r\n        this.messageReceivedHandler(user, message);\r\n    }\r\n    \r\n    // Event handlers\r\n    friendsListChangedHandler: (users: User[]) => void  = (users: User[]) => {};\r\n    messageReceivedHandler: (user: User, message: Message) => void = (user: User, message: Message) => {};\r\n}\r\n","export enum MessageType\r\n{\r\n    Text = 1,\r\n    File = 2\r\n}\r\n","import { MessageType } from './message-type.enum';\r\n\r\nexport class Message\r\n{\r\n    public type?: MessageType = MessageType.Text;\r\n    public fromId: any;\r\n    public toId: any;\r\n    public message: string;\r\n    public seenOn?: Date;\r\n}\r\n","export enum UserStatus\r\n{\r\n    Online,\r\n    Busy,\r\n    Away,\r\n    Offline\r\n}","import { UserStatus } from \"./user-status.enum\";\r\n\r\nexport class User\r\n{\r\n    public id: any;\r\n    public displayName: string;\r\n    public status: UserStatus;\r\n    public avatar: string;\r\n}","import { Message } from \"./message\";\r\nimport { User } from \"./user\";\r\n\r\nexport class Window\r\n{\r\n    public chattingTo: User;\r\n    public messages: Message[] = [];\r\n    public newMessage?: string = \"\";\r\n    \r\n    // UI Behavior properties\r\n    public isCollapsed?: boolean = false; \r\n    public isLoadingHistory: boolean = false;\r\n    public hasFocus: boolean = false;\r\n    public hasMoreMessages: boolean = true;\r\n    public historyPage: number = 0;\r\n}\r\n","import { Observable } from 'rxjs';\r\nimport { Message } from \"./message\";\r\nimport { User } from \"./user\";\r\nimport { ChatAdapter } from \"./chat-adapter\";\r\n\r\n/**\r\n * @description Chat Adapter decorator class that adds pagination to load the history of messagesr. \r\n * You will need an existing @see ChatAdapter implementation\r\n */\r\nexport abstract class PagedHistoryChatAdapter extends ChatAdapter\r\n{   \r\n    abstract getMessageHistoryByPage(userId: any, size: number, page: number) : Observable<Message[]>;\r\n}\r\n","export enum Theme\r\n{\r\n    Custom = 'custom-theme',\r\n    Light = 'light-theme',\r\n    Dark = 'dark-theme'\r\n}\r\n","export enum ScrollDirection {\r\n    Top,\r\n    Bottom\r\n}","import { IFileUploadAdapter } from './file-upload-adapter';\r\nimport { HttpClient, HttpRequest, HttpEventType, HttpResponse, HttpHeaders } from '@angular/common/http';\r\nimport { Observable, Subject } from 'rxjs';\r\nimport { User } from './user';\r\nimport { Message } from './message';\r\n\r\nexport class DefaultFileUploadAdapter implements IFileUploadAdapter\r\n{\r\n    /**\r\n     * @summary Basic file upload adapter implementation for HTTP request form file consumption\r\n     * @param _serverEndpointUrl The API endpoint full qualified address that will receive a form file to process and return the metadata.\r\n     */\r\n    constructor(private _serverEndpointUrl: string, private _http: HttpClient) {\r\n    }\r\n\r\n    uploadFile(file: File, userTo: User): Observable<Message> {\r\n        const formData: FormData = new FormData();\r\n\r\n        //formData.append('ng-chat-sender-userid', currentUserId);\r\n        formData.append('ng-chat-destinatary-userid', userTo.id);\r\n        formData.append('file', file, file.name);\r\n\r\n        return this._http.post<Message>(this._serverEndpointUrl, formData);\r\n\r\n        // TODO: Leaving this if we want to track upload progress in detail in the future. Might need a different Subject generic type wrapper\r\n        // const fileRequest = new HttpRequest('POST', this._serverEndpointUrl, formData, {\r\n        //     reportProgress: true\r\n        // });\r\n\r\n        // const uploadProgress = new Subject<number>();\r\n        // const uploadStatus = uploadProgress.asObservable();\r\n\r\n        //const responsePromise = new Subject<Message>();\r\n\r\n        // this._http\r\n        //     .request(fileRequest)\r\n        //     .subscribe(event => {\r\n        //         // if (event.type == HttpEventType.UploadProgress)\r\n        //         // {\r\n        //         //     const percentDone = Math.round(100 * event.loaded / event.total);\r\n\r\n        //         //     uploadProgress.next(percentDone);\r\n        //         // }\r\n        //         // else if (event instanceof HttpResponse)\r\n        //         // {\r\n                    \r\n        //         //     uploadProgress.complete();\r\n        //         // }\r\n        //     });\r\n    }\r\n}\r\n","import { Component, Input, OnInit, ViewChildren, ViewChild, HostListener, Output, EventEmitter, ElementRef } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { DomSanitizer } from '@angular/platform-browser';\r\n\r\nimport { ChatAdapter } from './core/chat-adapter';\r\nimport { User } from \"./core/user\";\r\nimport { Message } from \"./core/message\";\r\nimport { FileMessage } from \"./core/file-message\";\r\nimport { MessageType } from \"./core/message-type.enum\";\r\nimport { Window } from \"./core/window\";\r\nimport { UserStatus } from \"./core/user-status.enum\";\r\nimport { ScrollDirection } from \"./core/scroll-direction.enum\";\r\nimport { Localization, StatusDescription } from './core/localization';\r\nimport { IChatController } from './core/chat-controller';\r\nimport { PagedHistoryChatAdapter } from './core/paged-history-chat-adapter';\r\nimport { IFileUploadAdapter } from './core/file-upload-adapter';\r\nimport { DefaultFileUploadAdapter } from './core/default-file-upload-adapter';\r\nimport { Theme } from './core/theme.enum';\r\n\r\nimport { map } from 'rxjs/operators';\r\nimport { Observable } from 'rxjs';\r\n\r\n@Component({\r\n    selector: 'ng-chat',\r\n    templateUrl: 'ng-chat.component.html',\r\n    styleUrls: [\r\n        'assets/icons.css',\r\n        'assets/loading-spinner.css',\r\n        'assets/ng-chat.component.default.css',\r\n        'assets/themes/ng-chat.theme.default.scss',\r\n        'assets/themes/ng-chat.theme.dark.scss'\r\n    ],\r\n})\r\n\r\nexport class NgChat implements OnInit, IChatController {\r\n    constructor(public sanitizer: DomSanitizer, private _httpClient: HttpClient) { }\r\n\r\n    // Exposes enums for the ng-template\r\n    public UserStatus = UserStatus;\r\n    public MessageType = MessageType;\r\n\r\n    @Input()\r\n    public adapter: ChatAdapter;\r\n\r\n    @Input()\r\n    public userId: any;\r\n\r\n    @Input()\r\n    public isCollapsed: boolean = false;\r\n\r\n    @Input()\r\n    public maximizeWindowOnNewMessage: boolean = true;\r\n\r\n    @Input()    \r\n    public pollFriendsList: boolean = false;\r\n\r\n    @Input()\r\n    public pollingInterval: number = 5000;\r\n\r\n    @Input()    \r\n    public historyEnabled: boolean = true;\r\n\r\n    @Input()    \r\n    public emojisEnabled: boolean = true;\r\n\r\n    @Input()    \r\n    public linkfyEnabled: boolean = true;\r\n\r\n    @Input()\r\n    public audioEnabled: boolean = true;\r\n\r\n    @Input()\r\n    public searchEnabled: boolean = true;\r\n\r\n    @Input() // TODO: This might need a better content strategy\r\n    public audioSource: string = 'https://raw.githubusercontent.com/rpaschoal/ng-chat/master/src/ng-chat/assets/notification.wav';\r\n\r\n    @Input()\r\n    public persistWindowsState: boolean = true;\r\n\r\n    @Input()\r\n    public title: string = \"Friends\";\r\n\r\n    @Input()\r\n    public messagePlaceholder: string = \"Type a message\";\r\n\r\n    @Input()\r\n    public searchPlaceholder: string = \"Search\";\r\n\r\n    @Input()\r\n    public browserNotificationsEnabled: boolean = true;\r\n\r\n    @Input() // TODO: This might need a better content strategy\r\n    public browserNotificationIconSource: string = 'https://raw.githubusercontent.com/rpaschoal/ng-chat/master/src/ng-chat/assets/notification.png';\r\n\r\n    @Input()\r\n    public browserNotificationTitle: string = \"New message from\";\r\n    \r\n    @Input()\r\n    public historyPageSize: number = 10;\r\n\r\n    @Input()\r\n    public localization: Localization;\r\n\r\n    @Input()\r\n    public hideFriendsList: boolean = false;\r\n\r\n    @Input()\r\n    public hideFriendsListOnUnsupportedViewport: boolean = true;\r\n\r\n    @Input()\r\n    public fileUploadUrl: string;\r\n\r\n    @Input()\r\n    public theme: Theme = Theme.Light;\r\n\r\n    @Input()\r\n    public customTheme: string;\r\n\r\n    @Output()\r\n    public onUserClicked: EventEmitter<User> = new EventEmitter<User>();\r\n\r\n    @Output()\r\n    public onUserChatOpened: EventEmitter<User> = new EventEmitter<User>();\r\n\r\n    @Output()\r\n    public onUserChatClosed: EventEmitter<User> = new EventEmitter<User>();\r\n    \r\n    @Output()\r\n    public onMessagesSeen: EventEmitter<Message[]> = new EventEmitter<Message[]>();\r\n\r\n    private browserNotificationsBootstrapped: boolean = false;\r\n\r\n    public hasPagedHistory: boolean = false;\r\n\r\n    // Don't want to add this as a setting to simplify usage. Previous placeholder and title settings available to be used, or use full Localization object.\r\n    private statusDescription: StatusDescription = {\r\n        online: 'Online',\r\n        busy: 'Busy',\r\n        away: 'Away',\r\n        offline: 'Offline'\r\n    };\r\n\r\n    private audioFile: HTMLAudioElement;\r\n\r\n    public searchInput: string = '';\r\n\r\n    protected users: User[];\r\n\r\n    private get localStorageKey(): string \r\n    {\r\n        return `ng-chat-users-${this.userId}`; // Appending the user id so the state is unique per user in a computer.   \r\n    }; \r\n\r\n    get filteredUsers(): User[]\r\n    {\r\n        if (this.searchInput.length > 0){\r\n            // Searches in the friend list by the inputted search string\r\n            return this.users.filter(x => x.displayName.toUpperCase().includes(this.searchInput.toUpperCase()));\r\n        }\r\n\r\n        return this.users;\r\n    }\r\n\r\n    // Defines the size of each opened window to calculate how many windows can be opened on the viewport at the same time.\r\n    public windowSizeFactor: number = 320;\r\n\r\n    // Total width size of the friends list section\r\n    public friendsListWidth: number = 262;\r\n\r\n    // Available area to render the plugin\r\n    private viewPortTotalArea: number;\r\n    \r\n    // Set to true if there is no space to display at least one chat window and 'hideFriendsListOnUnsupportedViewport' is true\r\n    public unsupportedViewport: boolean = false;\r\n\r\n    // File upload state\r\n    public isUploadingFile = false;\r\n    public fileUploadAdapter: IFileUploadAdapter;\r\n\r\n    windows: Window[] = [];\r\n\r\n    isBootstrapped: boolean = false;\r\n\r\n    @ViewChildren('chatMessages') chatMessageClusters: any;\r\n\r\n    @ViewChildren('chatWindowInput') chatWindowInputs: any;\r\n\r\n    @ViewChild('nativeFileInput') nativeFileInput: ElementRef;\r\n\r\n    ngOnInit() { \r\n        this.bootstrapChat();\r\n    }\r\n\r\n    @HostListener('window:resize', ['$event'])\r\n    onResize(event: any){\r\n       this.viewPortTotalArea = event.target.innerWidth;\r\n\r\n       this.NormalizeWindows();\r\n    }\r\n\r\n    // Checks if there are more opened windows than the view port can display\r\n    private NormalizeWindows(): void\r\n    {\r\n        let maxSupportedOpenedWindows = Math.floor((this.viewPortTotalArea - (!this.hideFriendsList ? this.friendsListWidth : 0)) / this.windowSizeFactor);\r\n        let difference = this.windows.length - maxSupportedOpenedWindows;\r\n\r\n        if (difference >= 0){\r\n            this.windows.splice(this.windows.length - difference);\r\n        }\r\n\r\n        this.updateWindowsState(this.windows);\r\n\r\n        // Viewport should have space for at least one chat window.\r\n        this.unsupportedViewport = this.hideFriendsListOnUnsupportedViewport && maxSupportedOpenedWindows < 1;\r\n    }\r\n\r\n    // Initializes the chat plugin and the messaging adapter\r\n    private bootstrapChat(): void\r\n    {\r\n        let initializationException = null;\r\n\r\n        if (this.adapter != null && this.userId != null)\r\n        {\r\n            try\r\n            {\r\n                this.viewPortTotalArea = window.innerWidth;\r\n\r\n                this.initializeTheme();\r\n                this.initializeDefaultText();\r\n                this.initializeBrowserNotifications();\r\n\r\n                // Binding event listeners\r\n                this.adapter.messageReceivedHandler = (user, msg) => this.onMessageReceived(user, msg);\r\n                this.adapter.friendsListChangedHandler = (users) => this.onFriendsListChanged(users);\r\n\r\n                // Loading current users list\r\n                if (this.pollFriendsList){\r\n                    // Setting a long poll interval to update the friends list\r\n                    this.fetchFriendsList(true);\r\n                    setInterval(() => this.fetchFriendsList(false), this.pollingInterval);\r\n                }\r\n                else\r\n                {\r\n                    // Since polling was disabled, a friends list update mechanism will have to be implemented in the ChatAdapter.\r\n                    this.fetchFriendsList(true);\r\n                }\r\n                \r\n                this.bufferAudioFile();\r\n\r\n                this.hasPagedHistory = this.adapter instanceof PagedHistoryChatAdapter;\r\n                \r\n                if (this.fileUploadUrl && this.fileUploadUrl !== \"\")\r\n                {\r\n                    this.fileUploadAdapter = new DefaultFileUploadAdapter(this.fileUploadUrl, this._httpClient);\r\n                }\r\n\r\n                this.isBootstrapped = true;\r\n            }\r\n            catch(ex)\r\n            {\r\n                initializationException = ex;\r\n            }\r\n        }\r\n\r\n        if (!this.isBootstrapped){\r\n            console.error(\"ng-chat component couldn't be bootstrapped.\");\r\n            \r\n            if (this.userId == null){\r\n                console.error(\"ng-chat can't be initialized without an user id. Please make sure you've provided an userId as a parameter of the ng-chat component.\");\r\n            }\r\n            if (this.adapter == null){\r\n                console.error(\"ng-chat can't be bootstrapped without a ChatAdapter. Please make sure you've provided a ChatAdapter implementation as a parameter of the ng-chat component.\");\r\n            }\r\n            if (initializationException)\r\n            {\r\n                console.error(`An exception has occurred while initializing ng-chat. Details: ${initializationException.message}`);\r\n                console.error(initializationException);\r\n            }\r\n        }\r\n    }\r\n\r\n    // Initializes browser notifications\r\n    private async initializeBrowserNotifications()\r\n    {\r\n        if (this.browserNotificationsEnabled && (\"Notification\" in window))\r\n        {\r\n            if (await Notification.requestPermission())\r\n            {\r\n                this.browserNotificationsBootstrapped = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    // Initializes default text\r\n    private initializeDefaultText() : void\r\n    {\r\n        if (!this.localization)\r\n        {\r\n            this.localization = {\r\n                messagePlaceholder: this.messagePlaceholder,\r\n                searchPlaceholder: this.searchPlaceholder, \r\n                title: this.title,\r\n                statusDescription: this.statusDescription,\r\n                browserNotificationTitle: this.browserNotificationTitle,\r\n                loadMessageHistoryPlaceholder: \"Load older messages\"\r\n            };\r\n        }\r\n    }\r\n\r\n    private initializeTheme(): void\r\n    {\r\n        if (this.customTheme)\r\n        {\r\n            this.theme = Theme.Custom;\r\n        }\r\n        else if (this.theme != Theme.Light && this.theme != Theme.Dark)\r\n        {\r\n            // TODO: Use es2017 in future with Object.values(Theme).includes(this.theme) to do this check\r\n            throw new Error(`Invalid theme configuration for ng-chat. \"${this.theme}\" is not a valid theme value.`);\r\n        }\r\n    }\r\n\r\n    // Sends a request to load the friends list\r\n    private fetchFriendsList(isBootstrapping: boolean): void\r\n    {\r\n        this.adapter.listFriends()\r\n        .pipe(\r\n            map((users: User[]) => {\r\n                this.users = users;\r\n            })\r\n        ).subscribe(() => {\r\n            if (isBootstrapping)\r\n            {\r\n                this.restoreWindowsState();\r\n            }\r\n        });\r\n    }\r\n\r\n    fetchMessageHistory(window: Window) {\r\n        // Not ideal but will keep this until we decide if we are shipping pagination with the default adapter\r\n        if (this.adapter instanceof PagedHistoryChatAdapter)\r\n        {\r\n            window.isLoadingHistory = true;\r\n\r\n            this.adapter.getMessageHistoryByPage(window.chattingTo.id, this.historyPageSize, ++window.historyPage)\r\n            .pipe(\r\n                map((result: Message[]) => {\r\n                    result.forEach((message) => this.assertMessageType(message));\r\n                    \r\n                    window.messages = result.concat(window.messages);\r\n                    window.isLoadingHistory = false;\r\n    \r\n                    const direction: ScrollDirection = (window.historyPage == 1) ? ScrollDirection.Bottom : ScrollDirection.Top;\r\n                    window.hasMoreMessages = result.length == this.historyPageSize;\r\n                    \r\n                    setTimeout(() => this.onFetchMessageHistoryLoaded(result, window, direction, true));\r\n                })\r\n            ).subscribe();\r\n        }\r\n        else\r\n        {\r\n            this.adapter.getMessageHistory(window.chattingTo.id)\r\n            .pipe(\r\n                map((result: Message[]) => {\r\n                    result.forEach((message) => this.assertMessageType(message));\r\n    \r\n                    window.messages = result.concat(window.messages);\r\n                    window.isLoadingHistory = false;\r\n    \r\n                    setTimeout(() => this.onFetchMessageHistoryLoaded(result, window, ScrollDirection.Bottom));\r\n                })\r\n            ).subscribe();\r\n        }\r\n    }\r\n\r\n    private onFetchMessageHistoryLoaded(messages: Message[], window: Window, direction: ScrollDirection, forceMarkMessagesAsSeen: boolean = false): void \r\n    {\r\n        this.scrollChatWindow(window, direction)\r\n\r\n        if (window.hasFocus || forceMarkMessagesAsSeen)\r\n        {\r\n            const unseenMessages = messages.filter(m => !m.seenOn);\r\n\r\n            this.markMessagesAsRead(unseenMessages);\r\n            this.onMessagesSeen.emit(unseenMessages);\r\n        }\r\n    }\r\n\r\n    // Updates the friends list via the event handler\r\n    private onFriendsListChanged(users: User[]): void\r\n    {\r\n        if (users) \r\n        {\r\n            this.users = users;\r\n        }\r\n    }\r\n\r\n    // Handles received messages by the adapter\r\n    private onMessageReceived(user: User, message: Message)\r\n    {\r\n        if (user && message)\r\n        {\r\n            let chatWindow = this.openChatWindow(user);\r\n\r\n            this.assertMessageType(message);\r\n\r\n            if (!chatWindow[1] || !this.historyEnabled){\r\n                chatWindow[0].messages.push(message);\r\n\r\n                this.scrollChatWindow(chatWindow[0], ScrollDirection.Bottom);\r\n\r\n                if (chatWindow[0].hasFocus)\r\n                {\r\n                    this.markMessagesAsRead([message]);\r\n                    this.onMessagesSeen.emit([message]);\r\n                }\r\n            }\r\n\r\n            this.emitMessageSound(chatWindow[0]);\r\n            \r\n            // Github issue #58 \r\n            // Do not push browser notifications with message content for privacy purposes if the 'maximizeWindowOnNewMessage' setting is off and this is a new chat window.\r\n            if (this.maximizeWindowOnNewMessage || (!chatWindow[1] && !chatWindow[0].isCollapsed))\r\n            { \r\n                // Some messages are not pushed because they are loaded by fetching the history hence why we supply the message here\r\n                this.emitBrowserNotification(chatWindow[0], message);\r\n            }\r\n        }\r\n    }\r\n\r\n    // Opens a new chat whindow. Takes care of available viewport\r\n    // Returns => [Window: Window object reference, boolean: Indicates if this window is a new chat window]\r\n    public openChatWindow(user: User, focusOnNewWindow: boolean = false, invokedByUserClick: boolean = false): [Window, boolean]\r\n    {\r\n        // Is this window opened?\r\n        let openedWindow = this.windows.find(x => x.chattingTo.id == user.id);\r\n\r\n        if (!openedWindow)\r\n        {\r\n            if (invokedByUserClick) \r\n            {\r\n                this.onUserClicked.emit(user);\r\n            }\r\n\r\n            // Refer to issue #58 on Github \r\n            let collapseWindow = invokedByUserClick ? false : !this.maximizeWindowOnNewMessage;\r\n\r\n            let newChatWindow: Window = {\r\n                chattingTo: user,\r\n                messages:  [],\r\n                isLoadingHistory: this.historyEnabled,\r\n                hasFocus: false, // This will be triggered when the 'newMessage' input gets the current focus\r\n                isCollapsed: collapseWindow,\r\n                hasMoreMessages: false,\r\n                historyPage: 0\r\n            };\r\n\r\n            // Loads the chat history via an RxJs Observable\r\n            if (this.historyEnabled)\r\n            {\r\n                this.fetchMessageHistory(newChatWindow);\r\n            }\r\n\r\n            this.windows.unshift(newChatWindow);\r\n\r\n            // Is there enough space left in the view port ?\r\n            if (this.windows.length * this.windowSizeFactor >= this.viewPortTotalArea - (!this.hideFriendsList ? this.friendsListWidth : 0))\r\n            {                \r\n                this.windows.pop();\r\n            }\r\n\r\n            this.updateWindowsState(this.windows);\r\n            \r\n            if (focusOnNewWindow && !collapseWindow) \r\n            {\r\n                this.focusOnWindow(newChatWindow);\r\n            }\r\n            \r\n            this.onUserChatOpened.emit(user);\r\n\r\n            return [newChatWindow, true];\r\n        }\r\n        else\r\n        {\r\n            // Returns the existing chat window     \r\n            return [openedWindow, false];       \r\n        }\r\n    }\r\n\r\n    // Focus on the input element of the supplied window\r\n    private focusOnWindow(window: Window, callback: Function = () => {}) : void\r\n    {\r\n        let windowIndex = this.windows.indexOf(window);\r\n        if (windowIndex >= 0)\r\n        {\r\n            setTimeout(() => {\r\n                if (this.chatWindowInputs)\r\n                {\r\n                    let messageInputToFocus = this.chatWindowInputs.toArray()[windowIndex];\r\n                \r\n                    messageInputToFocus.nativeElement.focus(); \r\n                }\r\n\r\n                callback(); \r\n            });\r\n        } \r\n    }\r\n\r\n    // Scrolls a chat window message flow to the bottom\r\n    private scrollChatWindow(window: Window, direction: ScrollDirection): void\r\n    {\r\n        if (!window.isCollapsed){\r\n            let windowIndex = this.windows.indexOf(window);\r\n            setTimeout(() => {\r\n                if (this.chatMessageClusters){\r\n                    let targetWindow = this.chatMessageClusters.toArray()[windowIndex];\r\n\r\n                    if (targetWindow)\r\n                    {\r\n                        let element = this.chatMessageClusters.toArray()[windowIndex].nativeElement;\r\n                        let position = ( direction === ScrollDirection.Top ) ? 0 : element.scrollHeight;\r\n                        element.scrollTop = position;\r\n                    }\r\n                }\r\n            }); \r\n        }\r\n    }\r\n\r\n    // Marks all messages provided as read with the current time.\r\n    public markMessagesAsRead(messages: Message[]): void\r\n    {\r\n        let currentDate = new Date();\r\n\r\n        messages.forEach((msg)=>{\r\n            msg.seenOn = currentDate;\r\n        });\r\n    }\r\n\r\n    // Buffers audio file (For component's bootstrapping)\r\n    private bufferAudioFile(): void {\r\n        if (this.audioSource && this.audioSource.length > 0)\r\n        {\r\n            this.audioFile = new Audio();\r\n            this.audioFile.src = this.audioSource;\r\n            this.audioFile.load();\r\n        }\r\n    }\r\n\r\n    // Emits a message notification audio if enabled after every message received\r\n    private emitMessageSound(window: Window): void\r\n    {\r\n        if (this.audioEnabled && !window.hasFocus && this.audioFile) {\r\n            this.audioFile.play();\r\n        }\r\n    }\r\n\r\n    // Emits a browser notification\r\n    private emitBrowserNotification(window: Window, message: Message): void\r\n    {       \r\n        if (this.browserNotificationsBootstrapped && !window.hasFocus && message) {\r\n            let notification = new Notification(`${this.localization.browserNotificationTitle} ${window.chattingTo.displayName}`, {\r\n                'body': message.message,\r\n                'icon': this.browserNotificationIconSource\r\n            });\r\n\r\n            setTimeout(() => {\r\n                notification.close();\r\n            }, message.message.length <= 50 ? 5000 : 7000); // More time to read longer messages\r\n        }\r\n    }\r\n\r\n    // Saves current windows state into local storage if persistence is enabled\r\n    private updateWindowsState(windows: Window[]): void\r\n    {\r\n        if (this.persistWindowsState)\r\n        {\r\n            let usersIds = windows.map((w) => {\r\n                return w.chattingTo.id;\r\n            });\r\n\r\n            localStorage.setItem(this.localStorageKey, JSON.stringify(usersIds));\r\n        }\r\n    }\r\n\r\n    private restoreWindowsState(): void\r\n    {\r\n        try\r\n        {\r\n            if (this.persistWindowsState)\r\n            {\r\n                let stringfiedUserIds = localStorage.getItem(this.localStorageKey);\r\n\r\n                if (stringfiedUserIds && stringfiedUserIds.length > 0)\r\n                {\r\n                    let userIds = <number[]>JSON.parse(stringfiedUserIds);\r\n\r\n                    let usersToRestore = this.users.filter(u => userIds.indexOf(u.id) >= 0);\r\n\r\n                    usersToRestore.forEach((user) => {\r\n                        this.openChatWindow(user);\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        catch (ex)\r\n        {\r\n            console.error(`An error occurred while restoring ng-chat windows state. Details: ${ex}`);\r\n        }\r\n    }\r\n\r\n    // Gets closest open window if any. Most recent opened has priority (Right)\r\n    private getClosestWindow(window: Window): Window | undefined\r\n    {   \r\n        let index = this.windows.indexOf(window);\r\n\r\n        if (index > 0)\r\n        {\r\n            return this.windows[index - 1];\r\n        }\r\n        else if (index == 0 && this.windows.length > 1)\r\n        {   \r\n            return this.windows[index + 1];\r\n        }\r\n    }\r\n\r\n    private assertMessageType(message: Message): void {\r\n        // Always fallback to \"Text\" messages to avoid rendenring issues\r\n        if (!message.type)\r\n        {\r\n            message.type = MessageType.Text;\r\n        }\r\n    }\r\n\r\n    // Returns the total unread messages from a chat window. TODO: Could use some Angular pipes in the future \r\n    unreadMessagesTotal(window: Window): string\r\n    {\r\n        if (window){\r\n            let totalUnreadMessages = window.messages.filter(x => x.fromId != this.userId && !x.seenOn).length;\r\n            \r\n            if (totalUnreadMessages > 0){\r\n\r\n                if (totalUnreadMessages > 99) \r\n                    return  \"99+\";\r\n                else\r\n                    return String(totalUnreadMessages); \r\n            }\r\n        }\r\n            \r\n        // Empty fallback.\r\n        return \"\";\r\n    }\r\n\r\n    unreadMessagesTotalByUser(user: User): string\r\n    {\r\n        let openedWindow = this.windows.find(x => x.chattingTo.id == user.id);\r\n\r\n        if (openedWindow){\r\n            return this.unreadMessagesTotal(openedWindow);\r\n        }\r\n            \r\n        // Empty fallback.\r\n        return \"\";\r\n    }\r\n\r\n    /*  Monitors pressed keys on a chat window\r\n        - Dispatches a message when the ENTER key is pressed\r\n        - Tabs between windows on TAB or SHIFT + TAB\r\n        - Closes the current focused window on ESC\r\n    */\r\n    onChatInputTyped(event: any, window: Window): void\r\n    {\r\n        switch (event.keyCode)\r\n        {\r\n            case 13:\r\n                if (window.newMessage && window.newMessage.trim() != \"\")\r\n                {\r\n                    let message = new Message();\r\n             \r\n                    message.fromId = this.userId;\r\n                    message.toId = window.chattingTo.id;\r\n                    message.message = window.newMessage;\r\n        \r\n                    window.messages.push(message);\r\n        \r\n                    this.adapter.sendMessage(message);\r\n        \r\n                    window.newMessage = \"\"; // Resets the new message input\r\n        \r\n                    this.scrollChatWindow(window, ScrollDirection.Bottom);\r\n                }\r\n                break;\r\n            case 9:\r\n                event.preventDefault();\r\n                \r\n                let currentWindowIndex = this.windows.indexOf(window);\r\n                let messageInputToFocus = this.chatWindowInputs.toArray()[currentWindowIndex + (event.shiftKey ? 1 : -1)]; // Goes back on shift + tab\r\n\r\n                if (!messageInputToFocus)\r\n                {\r\n                    // Edge windows, go to start or end\r\n                    messageInputToFocus = this.chatWindowInputs.toArray()[currentWindowIndex > 0 ? 0 : this.chatWindowInputs.length - 1]; \r\n                }\r\n\r\n                messageInputToFocus.nativeElement.focus();\r\n\r\n                break;\r\n            case 27:\r\n                let closestWindow = this.getClosestWindow(window);\r\n\r\n                if (closestWindow)\r\n                {\r\n                    this.focusOnWindow(closestWindow, () => { this.onCloseChatWindow(window); });\r\n                }\r\n                else\r\n                {\r\n                    this.onCloseChatWindow(window);\r\n                }\r\n        }\r\n    }\r\n\r\n    // Closes a chat window via the close 'X' button\r\n    onCloseChatWindow(window: Window): void \r\n    {\r\n        let index = this.windows.indexOf(window);\r\n\r\n        this.windows.splice(index, 1);\r\n\r\n        this.updateWindowsState(this.windows);\r\n\r\n        this.onUserChatClosed.emit(window.chattingTo);\r\n    }\r\n\r\n    // Toggle friends list visibility\r\n    onChatTitleClicked(event: any): void\r\n    {\r\n        this.isCollapsed = !this.isCollapsed;\r\n    }\r\n\r\n    // Toggles a chat window visibility between maximized/minimized\r\n    onChatWindowClicked(window: Window): void\r\n    {\r\n        window.isCollapsed = !window.isCollapsed;\r\n        this.scrollChatWindow(window, ScrollDirection.Bottom);\r\n    }\r\n\r\n    // Asserts if a user avatar is visible in a chat cluster\r\n    isAvatarVisible(window: Window, message: Message, index: number): boolean\r\n    {\r\n        if (message.fromId != this.userId){\r\n            if (index == 0){\r\n                return true; // First message, good to show the thumbnail\r\n            }\r\n            else{\r\n                // Check if the previous message belongs to the same user, if it belongs there is no need to show the avatar again to form the message cluster\r\n                if (window.messages[index - 1].fromId != message.fromId){\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    // Toggles a window focus on the focus/blur of a 'newMessage' input\r\n    toggleWindowFocus(window: Window): void\r\n    {\r\n        window.hasFocus = !window.hasFocus;\r\n        if(window.hasFocus) {\r\n            const unreadMessages = window.messages.filter(message => message.seenOn == null && message.toId == this.userId);\r\n            \r\n            if (unreadMessages && unreadMessages.length > 0)\r\n            {\r\n                this.markMessagesAsRead(unreadMessages);\r\n                this.onMessagesSeen.emit(unreadMessages);\r\n            }\r\n        }\r\n    }\r\n\r\n    // [Localized] Returns the status descriptive title\r\n    getStatusTitle(status: UserStatus) : any\r\n    {\r\n        let currentStatus = status.toString().toLowerCase();\r\n\r\n        return this.localization.statusDescription[currentStatus];\r\n    }\r\n\r\n    triggerOpenChatWindow(user: User): void {\r\n        if (user)\r\n        {\r\n            this.openChatWindow(user);\r\n        }\r\n    }\r\n\r\n    triggerCloseChatWindow(userId: any): void {\r\n        let openedWindow = this.windows.find(x => x.chattingTo.id == userId);\r\n\r\n        if (openedWindow){\r\n            this.onCloseChatWindow(openedWindow);\r\n        }\r\n    }\r\n\r\n    triggerToggleChatWindowVisibility(userId: any): void {\r\n        let openedWindow = this.windows.find(x => x.chattingTo.id == userId);\r\n\r\n        if (openedWindow){\r\n            this.onChatWindowClicked(openedWindow);\r\n        }\r\n    }\r\n\r\n    // Triggers native file upload for file selection from the user\r\n    triggerNativeFileUpload(): void\r\n    {\r\n        this.nativeFileInput.nativeElement.click();\r\n    }\r\n\r\n    // Handles file selection and uploads the selected file using the file upload adapter\r\n    onFileChosen(window: Window): void {\r\n        const file: File = this.nativeFileInput.nativeElement.files[0];\r\n\r\n        this.isUploadingFile = true;\r\n\r\n        // TODO: Handle failure\r\n        this.fileUploadAdapter.uploadFile(file, window.chattingTo)\r\n            .subscribe(fileMessage => {\r\n                this.isUploadingFile = false;\r\n\r\n                fileMessage.fromId = this.userId;\r\n\r\n                // Push file message to current user window   \r\n                window.messages.push(fileMessage);\r\n    \r\n                this.adapter.sendMessage(fileMessage);\r\n    \r\n                this.scrollChatWindow(window, ScrollDirection.Bottom);\r\n\r\n                // Resets the file upload element\r\n                this.nativeFileInput.nativeElement.value = '';\r\n            });\r\n    }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\n\r\nlet emojiDictionary = [\r\n    { patterns: [':)', ':-)', '=)'], unicode: 'ð' },\r\n    { patterns: [':D', ':-D', '=D'], unicode: 'ð' },\r\n    { patterns: [':(', ':-(', '=('], unicode: 'ð' },\r\n    { patterns: [':|', ':-|', '=|'], unicode: 'ð' },\r\n    { patterns: [':*', ':-*', '=*'], unicode: 'ð' },\r\n    { patterns: ['T_T', 'T.T'], unicode: 'ð­' },\r\n    { patterns: [':O', ':-O', '=O', ':o', ':-o', '=o'], unicode: 'ð®' },\r\n    { patterns: [':P', ':-P', '=P', ':p', ':-p', '=p'], unicode: 'ð' },\r\n    { patterns: ['>.<'], unicode: 'ð£' },\r\n    { patterns: ['@.@'], unicode: 'ðµ' },\r\n    { patterns: ['*.*'], unicode: 'ð' },\r\n    { patterns: ['<3'], unicode: 'â¤ï¸' },\r\n    { patterns: ['^.^'], unicode: 'ð' },\r\n    { patterns: [':+1'], unicode: 'ð' },\r\n    { patterns: [':-1'], unicode: 'ð' }\r\n];\r\n\r\n/*\r\n * Transforms common emoji text to UTF encoded emojis\r\n*/\r\n@Pipe({name: 'emojify'})\r\nexport class EmojifyPipe implements PipeTransform {\r\n    transform(message: string, pipeEnabled: boolean): string {\r\n        if (pipeEnabled && message && message.length > 1) {  \r\n            emojiDictionary.forEach(emoji => {\r\n                emoji.patterns.forEach(pattern => {\r\n                    message = message.replace(pattern, emoji.unicode);\r\n                })\r\n            });\r\n        }\r\n\r\n    return message;\r\n  }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\n\r\n/*\r\n * Transforms text containing URLs or E-mails to valid links/mailtos\r\n*/\r\n@Pipe({name: 'linkfy'})\r\nexport class LinkfyPipe implements PipeTransform {\r\n    transform(message: string, pipeEnabled: boolean): string {\r\n        if (pipeEnabled && message && message.length > 1)\r\n        {\r\n            let replacedText;\r\n            let replacePatternProtocol;\r\n            let replacePatternWWW;\r\n            let replacePatternMailTo;\r\n\r\n            // URLs starting with http://, https://, or ftp://\r\n            replacePatternProtocol = /(\\b(https?|ftp):\\/\\/[-A-Z0-9+&@#\\/%?=~_|!:,.;]*[-A-Z0-9+&@#\\/%=~_|])/gim;\r\n            replacedText = message.replace(replacePatternProtocol, '<a href=\"$1\" target=\"_blank\">$1</a>');\r\n\r\n            // URLs starting with \"www.\" (ignoring // before it).\r\n            replacePatternWWW = /(^|[^\\/])(www\\.[\\S]+(\\b|$))/gim;\r\n            replacedText = replacedText.replace(replacePatternWWW, '$1<a href=\"http://$2\" target=\"_blank\">$2</a>');\r\n\r\n            // Change email addresses to mailto:: links.\r\n            replacePatternMailTo = /(([a-zA-Z0-9\\-\\_\\.])+@[a-zA-Z\\_]+?(\\.[a-zA-Z]{2,6})+)/gim;\r\n            replacedText = replacedText.replace(replacePatternMailTo, '<a href=\"mailto:$1\">$1</a>');\r\n\r\n            return replacedText;\r\n        }\r\n        else\r\n            return message;\r\n    } \r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { HttpClientModule } from '@angular/common/http';\r\n\r\nimport { NgChat } from './ng-chat.component';\r\nimport { EmojifyPipe } from './pipes/emojify.pipe';\r\nimport { LinkfyPipe } from './pipes/linkfy.pipe';\r\n\r\n@NgModule({\r\n  imports: [CommonModule, FormsModule, HttpClientModule],\r\n  declarations: [NgChat, EmojifyPipe, LinkfyPipe],\r\n  exports: [NgChat]\r\n})\r\nexport class NgChatModule {\r\n}\r\n"],"names":[],"mappings":"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"}
